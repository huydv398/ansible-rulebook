- hosts: localhost
  gather_facts: False
  connection: local
  vars:
    - netbox_url: 'http://172.16.66.124:8000'
    - netbox_token: '9d937a873ced4bf232571be636df540facfb23a7'
    - vm_name: "name={{ ansible_eda.event.payload.Alias }}"
    - message: |
        ```Summary: {{ ansible_eda.event.payload.Summary }}
        Output: {{ ansible_eda.event.payload.Summary }}```
  tasks:
  
    # - name: Define hostname in netbox  
    #   debug:
    #     msg: "{{ ansible_eda.event.payload.Summary }}"

    - name: Define hostname in netbox  
      # debug:
      #   msg: "{{ item.value.display }}"
      ansible.builtin.set_fact:
        hostname: "{{ item.value.display }}"
        id: "{{ item.value.id }}"
      loop: "{{ query('netbox.netbox.nb_lookup', 'virtual-machines', api_endpoint=netbox_url, api_filter=1628, token=netbox_token) }}"
      
      # register: output


    # - name: Create a journal entry 
    #   netbox.netbox.netbox_journal_entry:
    #     data:
    #       assigned_object_type: virtualization.virtualmachine
    #       assigned_object_id: "{{id}}"
    #       kind: info
    #       comments: "{{ message }}"
            
    #     # comments: |
    #     #   This is a journal entry
    #   # debug:
    #   #   msg: "{{id}}"
    #   when: hostname is defined 